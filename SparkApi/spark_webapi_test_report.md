[星火大模型webapi验证测试报告]

1. 项目背景和目标
   1.1 背景介绍
        鉴于chatGPT可能存在的随时可能被下架等不确定风险，需要考虑用迅飞星火平替。
        
   1.2 目标说明
       a.  确认星火webapi 是否可用，以及实现效果如何。
       b. 确认星火webapi 能否在esp32上使用，以考虑后续是直接在机器人端对接还是要走乐森云。


2. 功能描述
   2.1 功能概述
      使用迅飞云接口，包括
         a. 语音识别（https://www.xfyun.cn/doc/asr/voicedictation/API.html）
         b. 星火大模型输出文本回答(https://www.xfyun.cn/doc/spark/Web.html)
         c. 文本转tts (https://www.xfyun.cn/doc/tts/online_tts/API.html)
      在机器人上，完整的使用流程为：csk6输出用户录音，使用语音识别转换成文本内容，将文本内容输入星火大模型，星火会输出文本回复，再将回复的文本使用tts接口转为音频数据，在机器人本体上播放出来。
      
      流程图：
      ![Alt text](%E6%B3%B3%E9%81%93%E5%9B%BE.png)

   2.2 主要特点
      a. 全套使用迅飞云接口，都集中在同一个appid上即可完成，方便管理和查询数据。
      b. 可集成和使用星火大模型
      c. 语音识别支持动态修正，但只支持中文

   2.3 预期效果
      可在机器人本体上实现快速且流程的AI问答，期望提出问题后能在3s内给出回复，不必像chatGPT那样反应迟钝。

3. 技术方案
   3.1 实现方法 
      在机器人端通过websocket使用webapi接口集成实现即可。

   3.2 技术选择和理由
      a. 在国内响应应该会比chatgpt要快速一点
      b. 可替代在国内chatgpt可能会被墙的风险
      c. 在教育领域，星火的知识深度会更深
      d. 可在专业领域内添加自定义需求
      e. ASR可支持pcm，speex(8K), speex_wb(16K), mp3（中英）等音频格式

   3.3 技术优势与劣势
      优势如3.2
      与chatgpt相比，劣势如下：
         a. 知识面没有chatgpt广泛
         b. 文字比较生硬，没有感情
         c. 自主学习能力较差
         d. 上下文关系比较差

4. 需求分析
   4.1 硬件需求
      a. 需要使用语音模组+mic来获得录音数据
      b. 需要使用喇叭来播放响应的内容
      
   4.2 软件需求
      a. 对接csk6获得录音数据
      b. websocket实现与迅飞云的交互
      c. 音频播放接口

   4.3 数据需求
      -

5. 可行性分析
   5.1 技术可行性
      websocket能支持就行

   5.2 资源可行性
      可能需要三个websocket同时存在，具体资源损耗未知，参考之前的chatgpt实现，内存资源应该是能满足的。

   5.3 时间可行性
      未实际在机器人本体上实现完整流程，所以时间损耗未知，但通路是ok的

   5.4 经济可行性
      星火目前还未允许商用，相关的报价未知，但QPS应该也挺贵。
      小语种的识别和发音可能需要另外购买
      包括发音人音色等，可能也需要购买

6. 风险评估
   6.1 风险识别
      a. asr只支持60s内的语音
      b. asr的动态修正只支持中文
      c. asr建议每次发送pcm音频间隔40ms，每次发送音频字节数1280B。
      d. 目前的语音合成接口好像单次连接只能发送一次识别文本 --- 待确认
                  注：由于流式合成的文本只能一次性传输，不支持多次分段传输，此处status必须为2。

   6.2 应对策略
      -

7. 进度计划
   7.1 任务分解
      a. 目前pc端的webapi接口测试已ok，响应速度也还好（平均数值未统计）。
      b. 机器端的设备鉴权已ok
      c. 在先使用目前的asr和tts接口的前提下，准备接入星火nlp
      d. 星火没问题的话，考虑全套流程（asr/spark/tts）都直接使用迅飞云的方式

   7.2 时间计划
      待定

8. 测试计划
   8.1 验证和测试内容
   8.2 测试方法


9. 结论与建议
   a. 假如语音合成只支持单次合成的话，可能会对响应速度的体现产生影响
   b. 目前迅飞星火应该是主要支持中文，英文的效果有待考究
   c. asr的动态修正只支持中文，所以英文的识别效果可能就会稍微差一点
   d. 星火何时才能商用，可能也是一个考虑的因素
   e. 星火的内容端目前有点差强人意
